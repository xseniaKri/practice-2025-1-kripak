# Пошаговое руководство: как создать телеграм-бота
В этом руководстве я опишу создание проекта на выбранную мной тему.

## Подготовка к разработке

### 1. Подготовка среды разработки

Перед началом разработки потребуется:

* Установить интерпретатор Python последней версии (например, Python 3.10 или выше).
* Настроить виртуальное окружение для управления зависимостями проекта.
* Создать новую директорию проекта и инициализировать её как рабочую директорию.

### 2. Регистрация бота

Для создания Telegram-бота потребуется:

* В Telegram найти и использовать официального бота **@BotFather**.
* Запустить команду создания нового бота.
* Указать имя и уникальный username.
* Получить токен — уникальный ключ доступа к API, который впоследствии будет использован в коде.

---

## Структура проекта

Далее нужно сформировать базовую структуру проекта, например:
```
quiz_bot/
├── data/
│   └── questions.json      # вопросы викторины
├── keyboards/
│   └── quiz_kb.py          # клавиатуры
├── handlers/
│   └── quiz_handler.py     # логика викторины
├── main.py                 # запуск бота
├── config.py               # токен бота
├── requirements.txt        # зависимости
```

Такая структура позволит упростить поддержку и расширение функциональности.

---

## Формат хранения данных

Вопросы викторины можно хранить во внешнем файле в формате JSON. Это позволит:

* Упрощённо редактировать и дополнять базу вопросов;
* Хранить каждый вопрос как объект с текстом, списком вариантов и правильным ответом;
* Гибко масштабировать количество заданий.

---

## Реализация пользовательского интерфейса

Для взаимодействия пользователя с ботом стоит использоваться инлайн-клавиатуры. Они позволят:

* Отображать варианты ответов непосредственно под вопросом;
* Позволить пользователю выбрать ответ одним нажатием;
* Получать callback-событие от Telegram и обрабатывать его.

Эти клавиатуры позволит создать библиотека Aiogram. В ней инлайн-клавиатуры работают следующим образом:

- Создаётся объект клавиатуры (`InlineKeyboardMarkup`).
- В клавиатуру добавляются кнопки (`InlineKeyboardButton`), каждая с текстом и уникальным callback-данными.
- Когда пользователь нажимает кнопку, бот получает callback-запрос с этими данными.
- Бот обрабатывает callback и выполняет нужное действие (например, проверяет ответ викторины).

Далее показан пример создания и обработки инлайн-клавиатуры

```python
from aiogram import Bot, Dispatcher, types
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from aiogram.utils import executor

API_TOKEN = 'YOUR_BOT_TOKEN'

bot = Bot(token=API_TOKEN)
dp = Dispatcher(bot)

# Создание инлайн-клавиатуры с двумя кнопками
inline_kb = InlineKeyboardMarkup(row_width=2)
btn1 = InlineKeyboardButton("Ответ 1", callback_data="answer_1")
btn2 = InlineKeyboardButton("Ответ 2", callback_data="answer_2")
inline_kb.add(btn1, btn2)

# Обработчик, срабатывает по нажатию команды старт
@dp.message_handler(commands=['start'])
async def send_welcome(message: types.Message):
    await message.answer("Выберите правильный ответ:", reply_markup=inline_kb)

# Обработчик, страбатывает по нажатию на кнопку
@dp.callback_query_handler(lambda c: c.data and c.data.startswith('answer_'))
async def process_callback(callback_query: types.CallbackQuery):
    answer = callback_query.data  # например, 'answer_1'
    if answer == "answer_1":
        response = "Правильно!"
    else:
        response = "Неправильно!"
    await bot.answer_callback_query(callback_query.id, text=response)
    await bot.send_message(callback_query.from_user.id, response)

if __name__ == '__main__':
    executor.start_polling(dp)
```
---

## Логика викторины

Необходимо продумать бизнес-логику. Основные этапы работы бота будут включать:

1. Приём команды от пользователя (например, `/start` или `/quiz`);
2. Загрузка первого вопроса из списка;
3. Последовательный вывод вопросов с возможностью выбора ответа;
4. Подсчёт количества правильных ответов;
5. Отображение итогового результата и предложение начать заново.

Нужно реализовать механизм отслеживания состояния пользователя, чтобы знать, на каком вопросе он находится и какой результат набрал - это делается при помощи FSMContext и States.
Все эти инструменты предоставляет библиотека Aiogram, в ее [документации](https://docs.aiogram.dev/en/v3.20.0.post0/) есть также примеры кода, по ним можно легко реализовать все необходимые функции.

---
## Обработка событий
Для организации логики обработки входящих сообщений и событий в Aiogram используются механизмы Dispatcher и Router.

**Dispatcher** — это основной компонент, который будет получать все входящие обновления от Telegram и направлять их нужным обработчикам. Его задачей будет:

- Слушать сообщения, команды и другие события;
- Определять, какой обработчик должен сработать;
- Управлять потоком данных между пользователем и логикой бота.

Таким образом, `Dispatcher` будет выступать в роли центра обработки событий, через который будет проходить вся логика.

**Router** — это более современный и модульный способ организации логики, появившийся в Aiogram 3.x. Он позволит разделить разные части логики на независимые блоки. Например:

- Один роутер будет отвечать за команду `/start`;
- Второй — за логику викторины;
- Третий — за обработку ошибок.

  <сюда схему>

При необходимости в будущем масштабирования проекта использование Router сделает код более читаемым и структурированным. В простых проектах, использующих Aiogram 2.x, обычно используется только `Dispatcher`, но

## Настройка маршрутизации событий

Для корректной работы с Telegram API потребуется:

* Настроить диспетчер сообщений (`Dispatcher`), который будет слушать команды и callback-запросы;
* Зарегистрировать обработчики команд и ответов;
* Обеспечить запуск бота через метод `executor.start_polling`.

Можно выбрать вариант через технологию webhook, но он более сложен в реализации и требует выделенного IP-адреса, и установленного SSL на сервере.
Поэтому рекомендуется использовать технологию Long Polling - сервер с логикой телеграм-бота (наша хост машина) будет выступать в качестве клиента и регулярно опрашивать сервер Telegram на появление новых событий в боте.

<img src="https://github.com/user-attachments/assets/28756735-edcb-48a3-a8fb-9d4f7c80920c" width="30%" height="30%">

---

## Тестирование

После реализации всех компонентов потребуется:

* Запустить бота в локальной среде;
* Проверить корректность отображения вопросов и обработки ответов;
* Убедиться, что результаты викторины подсчитываются корректно.

---

## Заключение

В результате реализации описанных шагов будет создан Telegram-бот, способный проводить викторину в интерактивном формате. Такой проект послужит хорошей основой для дальнейшего изучения Telegram API, асинхронного программирования и разработки пользовательских сервисов.

---
